!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Timeline=e():t.Timeline=e()}(this,function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dist/",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);const s=14,n=16,o=n,r="CENTER_CHANGE_DONE",a="ZOOM_DONE",h="SCROLL_DONE",l=8;["rgba(211,84,0","rgba(219,10,91","rgba(31,58,147","rgba(0,128,0"].map(t=>(e=1)=>`${t},${e})`);const c=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function u(t){return d[t.getUTCMonth()]}function f(t){const e=t.getUTCDate();return`${c[t.getUTCDay()]}, ${e}${function(t){return["st","nd","rd"][((t+90)%100-10)%10-1]||"th"}(e)}`}function p(t){return t.getUTCHours().toString().padStart(2,"0")}function m(t){return t.getUTCMinutes().toString().padStart(2,"0")}function g(t){return t.getUTCSeconds().toString().padStart(2,"0")}function v(t){return t.getUTCMilliseconds().toString().padStart(3,"0")}function w(t){return"YEAR"===t||"YEAR_5"===t||"DECADE"===t||"DECADE_5"===t||"CENTURY"===t||"CENTURY_5"===t||"MILLENIUM"===t}const C=(t,e)=>{if(null==t)return"âˆž";const i=new Date(t);let s=i.getUTCFullYear().toString();return w(e)?s:(s=`${u(i)} ${s}`,"MONHT"===e?s:(s=`${f(i)} ${s}`,"DAY"===e?s:(s=`${s} at ${p(i)}:`,"HOUR"===e?`${s}00`:(s=`${s}${m(i)}`,"MINUTE"===e?s:(s=`${s}:${g(i)}`,"SECOND"===e?s:`${s}.${v(i)}`)))))},T=t=>t>58?"MILLISECOND":t>12?"MILLISECOND_10":t>2.3?"MILLISECOND_50":t>1.5?"MILLISECOND_100":t>.4?"MILLISECOND_500":t>.00112?"SECOND":t>112e-6?"MINUTE":t>112e-7?"HOUR":t>8e-7?"DAY":t>2.6e-7?"WEEK":t>2.2e-8?"MONHT":t>2.2e-9?"YEAR":t>3.3e-10?"YEAR_5":t>1.6e-10?"DECADE":t>8e-11?"DECADE_5":t>1e-11?"CENTURY":t>5e-12?"CENTURY_5":"MILLENIUM",E=t=>{if("YEAR"===t)return 1;if("YEAR_5"===t)return 5;if("DECADE"===t)return 10;if("DECADE_5"===t)return 50;if("CENTURY"===t)return 100;if("CENTURY_5"===t)return 500;if("MILLENIUM"===t)return 1e3;if("MILLISECOND"===t)return 1;if("MILLISECOND_10"===t)return 10;if("MILLISECOND_50"===t)return 50;if("MILLISECOND_100"===t)return 100;if("MILLISECOND_500"===t)return 500;throw new RangeError("[getStep] Only steps with a granularity greater than 'year' calculated")};function b(t,e){const i=null!=t.date_min?t.date_min:t.date,s=null!=e.date_min?e.date_min:e.date;if(i<s)return-1;if(i>s)return 1;const n=null!=t.end_date_max?t.end_date_max:t.end_date,o=null!=e.end_date_max?e.end_date_max:e.end_date;return n<o?-1:n>o?1:0}const x=(t,e)=>{const i=new Date(t);return w(e)?i.getUTCFullYear().toString():"MONHT"===e?u(i):"WEEK"===e?`${u(i)}, week ${(t=>{const e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),i=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-i);const s=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e.getTime()-s.getTime())/864e5+1)/7)})(i)}`:"DAY"===e?`${f(i)} ${u(i)}`:"HOUR"===e?`${p(i)}:00`:"MINUTE"===e?`${p(i)}:${m(i)}`:"SECOND"===e?`${p(i)}:${m(i)}:${g(i)}`:"MILLISECOND"===e.slice(0,"MILLISECOND".length)?`${p(i)}:${m(i)}:${g(i)}.${v(i)}`:void 0},M=(t,e)=>{let i;return()=>{clearTimeout(i),i=setTimeout(t,e)}};function D(t){return Math.pow(2,-1*t)}function L(t,e,i){return t/D(e)/i}function U(t){if(null==t)return null;const e=new Date(t);return`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`}var z;!function(t){t[t.Backward=-1]="Backward",t[t.Stop=0]="Stop",t[t.Forward=1]="Forward"}(z||(z={}));var O=new class{constructor(){this.elapsedTimeThreshold=2e3,this.goToDuration=300,this.zoomToDuration=300,this.multipliers=[.25,.5,1,2,4,8,16],this.multiplier=1,this.direction=z.Stop,this.elapsedTimeTotal=0,this.models=[],this.views=[],this.animate=(t=>{const e=null==this.prevTimestamp?0:t-this.prevTimestamp;if(e>0||null==this.prevTimestamp){if(null==this.centerMarker&&null==this.zoomMarker)X.center+=X.eventsBands[0].time/7.5*this.multiplier*this.direction;else if(null!=this.centerMarker){const t=this.goToDuration-this.elapsedTimeTotal,i=Math.abs(this.centerMarker-X.center)/(t/e);t<e?(X.center=this.centerMarker,this.stop()):X.center=X.center+i*this.direction}else if(null!=this.zoomMarker){const t=this.zoomToDuration-this.elapsedTimeTotal,i=(this.zoomMarker-this.activeBand.zoomLevel)/(t/e);if(t<e)this.activeBand.zoomLevel=this.zoomMarker,X.eventsBands.forEach(t=>{t===this.activeBand?this.activeBand.zoomLevel=this.zoomMarker:t.zoomLevel=this.zoomMarker+(t.config.zoomLevel-this.activeBand.config.zoomLevel)}),this.adjustMinimapBands(),document.dispatchEvent(new CustomEvent(a)),this.stop();else{for(const t of X.eventsBands)t.zoomLevel=t.zoomLevel+i;this.adjustMinimapBands()}}this.models.forEach(t=>t.update()),this.views.forEach(t=>t.update())}this.elapsedTimeTotal+=e,this.elapsedTimeTotal>this.elapsedTimeThreshold&&this.resetElapsedTimeTotal(),(this.isPlaying()||null!=this.zoomMarker)&&(X.center>=X.from&&X.center<=X.to||null!=this.centerMarker||null!=this.zoomMarker?(this.prevTimestamp=t,requestAnimationFrame(this.animate)):this.stop())})}registerModel(t){this.models.push(t)}registerView(t){this.views.push(t)}adjustMinimapBands(){X.minimapBands.forEach(t=>{this.activeBand.zoomLevel<t.config.zoomLevel&&(t.zoomLevel=this.activeBand.zoomLevel)})}resetElapsedTimeTotal(){this.elapsedTimeTotal=0,document.dispatchEvent(new CustomEvent(r))}accelerate(){const t=this.multipliers.indexOf(this.multiplier);return t===this.multipliers.length-1?this.multipliers[this.multipliers.length-1]:(this.multiplier=this.multipliers[t+1],this.multiplier)}decelerate(){const t=this.multipliers.indexOf(this.multiplier);return 0===t?this.multipliers[0]:(this.multiplier=this.multipliers[t-1],this.multiplier)}goTo(t){this.centerMarker=t,t>X.center?this.playForward():this.playBackward()}zoomTo(t,e){null==this.zoomMarker&&(e<0&&(e=0),t!==this.activeBand&&(this.stop(),this.activeBand=t),this.activeBand.zoomLevel!==e&&(this.zoomMarker=e,this.nextFrame()))}speed(t){const e=parseFloat(t);-1!==this.multipliers.indexOf(e)&&(this.multiplier=e)}isPlaying(){return this.direction!==z.Stop}isPlayingForward(){return this.direction===z.Forward}isPlayingBackward(){return this.direction===z.Backward}nextFrame(){requestAnimationFrame(this.animate)}playForward(){this.direction=z.Forward,this.nextFrame()}playBackward(){this.direction=z.Backward,this.nextFrame()}stop(){this.direction=z.Stop,this.activeBand=null,this.centerMarker=null,this.zoomMarker=null,this.prevTimestamp=null,this.elapsedTimeTotal=0}toggle(){this.isPlaying()?this.stop():this.nextFrame()}};class _{constructor(t){this.config=t,this.defaultZoomLevel=0}get offsetX(){return this._offsetX}set offsetX(t){this.prevOffsetX=this.offsetX||t,this._offsetX=t}get zoomLevel(){return this._zoomLevel}set zoomLevel(t){t<0&&(t=0),this.visibleRatio=D(t),this.width=Math.round(X.viewportWidth/this.visibleRatio),this.pixelsPerMillisecond=this.width/X.time,this.time=this.visibleRatio*X.time,this.granularity=T(this.pixelsPerMillisecond),this.nextDate=function(t){return w(t)?e=>{let i=new Date(e),s=i.getUTCFullYear()+1;if("YEAR"!==t){const e=E(t);for(;s%e!=0;)s+=1}return s>-1&&s<100?(i.setUTCFullYear(s),i.getTime()):Date.UTC(s,0,1)}:"MONHT"===t?t=>{const e=new Date(t);return Date.UTC(e.getUTCFullYear(),e.getUTCMonth()+1,1)}:"WEEK"===t?t=>{const e=new Date(t);return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()+7)}:"DAY"===t?t=>{const e=new Date(t);return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()+1)}:"HOUR"===t?t=>{const e=new Date(t);return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours()+1)}:"MINUTE"===t?t=>{const e=new Date(t);return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes()+1)}:"SECOND"===t?t=>{const e=new Date(t);return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()+1)}:"MILLISECOND"===t.slice(0,"MILLISECOND".length)?e=>{const i=E(t),s=new Date(e);let n=s.getUTCMilliseconds()+1;return i>1&&(n=n+i-n%i),Date.UTC(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate(),s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),n)}:void 0}(this.granularity),this.prevZoomLevel=this.zoomLevel||t,this._zoomLevel=t,this.setHorizontalProps()}setVerticalProps(){this.visibleHeight=Math.round(this.config.heightRatio*X.viewportHeight),this.availableHeight=this.visibleHeight-o,this.visibleRowsCount=Math.floor(this.availableHeight/n),this.top=Math.round(this.config.topOffsetRatio*X.viewportHeight)}setHorizontalProps(){this.from=X.center-this.time/2,this.to=X.center+this.time/2,this.offsetX=(X.from-this.from)*this.pixelsPerMillisecond}init(){this.zoomLevel=this.config.zoomLevel,this.setVerticalProps(),O.registerModel(this)}resize(){this.zoomLevel=this.zoomLevel,this.setVerticalProps()}update(){this.setHorizontalProps()}updateConfig(t){Object.keys(t).forEach(e=>{this.config.hasOwnProperty(e)&&(this.config[e]=t[e])})}positionAtTimestamp(t){return Math.round((t-this.from)*this.pixelsPerMillisecond)}timestampAtProportion(t){return X.from+X.time*t}timestampAtPosition(t){return this.from+t/this.pixelsPerMillisecond}}class y{constructor(){this.heightRatio=1,this.rulers=!0,this.rulerLabels=!0,this.topOffsetRatio=0,this.zoomLevel=0}}class Y extends y{constructor(){super(...arguments),this.indicatorFor=0,this.targets=[]}}class S extends y{}class R{}let I;if("undefined"!=typeof window){const t=document.createElement("style");document.head.appendChild(t),I=t.sheet}const H={};var N=(t,e,i,s)=>{if(!e)return document.createElement(t);let n;return H.hasOwnProperty(e)?n=H[e].cloneNode(!1):((n=document.createElement(t)).classList.add(e),i&&I.insertRule(`.${e} { ${i.join(";").concat(";")} }`),H[e]=n.cloneNode(!1)),s&&n.setAttribute("style",s.join(";").concat(";")),n};class P extends _{constructor(t){super(function(t){const e=Object.assign({},new Y,t);return e.targets.length||e.targets.push(0),e}(t)),this.isDrawn=!1,this.canvas=N("canvas"),this.ctx=this.canvas.getContext("2d"),this.nextCanvas=N("canvas"),this.nextCtx=this.nextCanvas.getContext("2d")}init(){super.init(),this.maxRowCount=this.config.targets.reduce((t,e)=>{const{rowCount:i}=X.eventsBands[e];return Math.max(t,i)},0);const t=this.availableHeight/this.maxRowCount;this.eventHeight=t<1?1:Math.round(t),this.canvas.width=X.viewportWidth,this.canvas.height=this.maxRowCount*this.eventHeight,this.nextCanvas.width=X.viewportWidth,this.nextCanvas.height=this.maxRowCount*this.eventHeight}resize(){super.resize(),this.isDrawn=!1}draw(){return this.isDrawn?this.updateNextCanvas():this.drawEvents(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.nextCanvas,0,0),this.canvas}drawEvents(t=this.from,e=this.to){this.nextCtx.beginPath(),this.config.targets.forEach(i=>{const s=X.eventsBands[i];for(const i of s.events){if(i.from>e||i.to<t)continue;const s=Math.round(i.time*this.pixelsPerMillisecond),n=this.positionAtTimestamp(null!=i.date_min?i.date_min:i.date),o=this.maxRowCount-(i.row+1)*this.eventHeight,r=s<1?1:s;this.nextCtx.rect(n,o,r,this.eventHeight)}}),this.nextCtx.fillStyle="rgb(190, 190, 190)",this.nextCtx.fill()}updateNextCanvas(){const t=Math.round(this.offsetX-this.prevOffsetX);if(0===t)return this.canvas;let e,i;this.nextCtx.clearRect(0,0,this.nextCanvas.width,this.nextCanvas.height),this.nextCtx.drawImage(this.canvas,t,0),t<0?(e=this.timestampAtPosition(X.viewportWidth+t),i=this.to):(e=this.from,i=this.timestampAtPosition(t)),this.drawEvents(e,i)}}class A{constructor(){this.events=[],this.row_count=0}}const B=8;function $(t,e){if(!t.length)return new A;let i=0;const n=[],o=2*s/e;return{events:t=t.map(t=>{let s;null==t.label&&(t.label="NO LABEL"),t.from=t.date_min||t.date,t.to=t.end_date_max||t.end_date,null==t.to&&(t.to=t.from),t.time=null==t.to?0:t.to-t.from,t.space=0,t.time||(null==t.label&&(t.label="NO LABEL"),t.space=t.label.length*B/e+o);let r=0;for(;null==s&&r<n.length;){let e=0,i=!0;for(;i&&e<n[r].length&&!(t.to<n[r][e][0]);)i=t.from>n[r][e][1],e++;i&&(n[r].push([t.from,t.from+t.time+t.space]),s=r),r++}return null==s&&(s=n.push([[t.from,t.from+t.time+t.space]])-1),s>i&&(i=s),t.row=s,t}),row_count:n.length}}class k extends _{constructor(t){super(Object.assign({},new S,t)),this.events=[],this.rowCount=0,this.visibleEvents=[],this._offsetY=0,null!=this.config.events&&this.config.events.sort(b)}get offsetY(){return this._offsetY}set offsetY(t){this._offsetY+=t,this._offsetY<0&&(this._offsetY=0);const e=this.height>this.availableHeight?this.height-this.availableHeight+n:0;this._offsetY>e&&(this._offsetY=e);const i=this._offsetY/n;this.lowestVisibleRow=Math.ceil(i),this.highestVisibleRow=this.lowestVisibleRow+this.visibleRowsCount}init(){super.init();const t=L(X.viewportWidth,this.config.zoomLevel||0,X.time),e=null==this.config.orderedEvents?$(this.config.events,t):this.config.orderedEvents;this.events=e.events,this.rowCount=e.row_count,this.height=n*this.rowCount,this.offsetY=0,this.updateEvents()}updateEvents(){this.visibleEvents=this.events.filter(t=>!(t.from>this.to||t.to<this.from)&&t.row>=this.lowestVisibleRow&&t.row<=this.highestVisibleRow).map(t=>(t.left=this.positionAtTimestamp(t.from),t.width=Math.round(t.time*this.pixelsPerMillisecond),t.time&&t.width<1&&(t.width=1),t.padding=Math.round(t.space*this.pixelsPerMillisecond),t.top=this.top+this.availableHeight-(t.row+1)*n+this.offsetY,t))}update(){super.update(),this.updateEvents()}getEventByCoordinates(t,e){const i=this.timestampAtPosition(t),s=X.viewportOffset+this.top+this.availableHeight+this.offsetY,o=Math.floor((s-e)/n);return this.events.find(t=>!(!(t.from<i&&t.from+t.time+t.space>i)||t.row<this.lowestVisibleRow||t.row>this.highestVisibleRow)&&t.row===o)}zoomIn(){O.zoomTo(this,this.zoomLevel+1)}zoomOut(){O.zoomTo(this,this.zoomLevel-1)}}function F(t){return t instanceof k}function W(t){return t instanceof P}var X=new class{constructor(){this.defaultCenterRatio=.5,this.centerChangeDone=M(()=>{document.dispatchEvent(new CustomEvent(r))},300)}get center(){return this._center}set center(t){this._center===this.from&&t<this.from||this._center===this.to&&t>this.to||(t<this.from?this._center=this.from:t>this.to?this._center=this.to:this._center=t,this.centerChangeDone())}set dimensions(t){const e=getComputedStyle(t);this.viewportHeight=parseInt(e.getPropertyValue("height"),10),this.viewportOffset=t.getBoundingClientRect().top,this.viewportWidth=parseInt(e.getPropertyValue("width"),10)}init(t){null==t.rootElement&&console.error("[init] No rootElement found"),this.rootElement=t.rootElement,this.dimensions=this.rootElement;const[e,i]=t.bands.reduce((t,e)=>{if(console.log(e instanceof P),console.log(typeof e),e instanceof P)return t;const i=null==e.config.orderedEvents?e.config.events:e.config.orderedEvents.events;return t[0].push(i[0].date_min||i[0].date),t[1].push(i.reduce((t,e)=>Math.max(t,e.end_date||-1/0,e.end_date_max||-1/0),-1/0)),t},[[],[]]);this.from=Math.min(...e),this.to=Math.max(...i),this.time=this.to-this.from,this.center=null!=t.center?t.center:this.from+this.defaultCenterRatio*this.time,this.bands=t.bands,this.eventsBands=this.bands.filter(F),this.minimapBands=this.bands.filter(W);for(const t of this.bands)t.init()}resize(){this.dimensions=this.rootElement}};var j=new class{constructor(){this.eventsListeners=[]}register(t,e,i=document){i.addEventListener(t,e),this.eventsListeners.push([t,e,i])}flush(){this.eventsListeners.forEach(t=>{const[e,i,s]=t;s.removeEventListener(e,i)}),this.eventsListeners=[]}};class V{constructor(t){this.band=t,this.onMouseDown=(t=>{document.addEventListener("mouseup",this.onMouseUp),this.dragStartTime=Date.now(),this.dragStartPosition=[t.clientX,t.clientY],this.dragOffsetX=t.clientX,this.dragOffsetY=t.clientY}),this.onMouseMove=(t=>{if(null==this.dragOffsetX)return;this.band instanceof k&&(this.band.offsetY=t.clientY-this.dragOffsetY);const e=(this.dragOffsetX-t.clientX)/this.band.pixelsPerMillisecond;X.center+=e,O.nextFrame(),this.dragOffsetX=t.clientX,this.dragOffsetY=t.clientY}),this.onMouseUp=(t=>{this.lastDragInterval=Date.now()-this.dragStartTime,this.dispatchScrollDoneEvent(t),this.dragOffsetX=null,this.dragOffsetY=null,document.removeEventListener("mouseup",this.onMouseUp)}),this.onDblClick=(t=>{const e=this.band.timestampAtPosition(t.clientX);O.goTo(e)})}render(){return this.rootElement=N("div","band-wrap",["position: absolute","z-index: 2"],[`height: ${this.band.visibleHeight}px`,`top: ${this.band.top}px`,`width: ${X.viewportWidth}px`]),j.register("mousedown",this.onMouseDown,this.rootElement),j.register("mousemove",this.onMouseMove,this.rootElement),j.register("dblclick",this.onDblClick,this.rootElement),this.rootElement}dispatchScrollDoneEvent(t){const e=[this.dragStartPosition[0]-t.clientX,this.dragStartPosition[1]-t.clientY].map(Math.abs).some(t=>t>5);(this.lastDragInterval>200||e)&&document.dispatchEvent(new CustomEvent(h))}resize(){this.rootElement.style.cssText=`height: ${this.band.visibleHeight}px; top: ${this.band.top}px; width: ${X.viewportWidth}px;`}}class Z{constructor(t){this.onChange=t,this.animator=O,this.handleChange=(()=>{this.onChange({center:X.center,bands:X.bands})}),this.resize=(()=>{X.resize();for(const t of X.bands)t.resize();for(const t of this.views)t.resize();this.animator.nextFrame()}),document.addEventListener("keydown",t=>{189===t.keyCode&&X.eventsBands[0].zoomOut(),187===t.keyCode&&X.eventsBands[0].zoomIn()}),null!=this.onChange&&"function"==typeof this.onChange&&(document.addEventListener(r,this.handleChange),document.addEventListener(a,this.handleChange))}reload(){this.resize()}}class J extends V{constructor(t,e){super(t),this.band=t,this.select=e,this.onWheel=(t=>{0===Math.abs(t.deltaX)&&0!==t.deltaY&&(t.deltaY<0&&this.zoomOut(),t.deltaY>0&&this.zoomIn())}),this.onClick=(t=>{if(this.lastDragInterval>175)return;const e=this.band.getEventByCoordinates(t.clientX,t.clientY);e&&this.select&&(this.select(e),function(t,...e){console.log(t.label,t,t.left,U(t.from),U(t.to),e)}(e))})}render(){const t=super.render();return j.register("click",this.onClick,this.rootElement),j.register("wheel",this.onWheel,this.rootElement),t}zoomIn(){this.band.zoomIn()}zoomOut(){this.band.zoomOut()}}const K="11px sans-serif",q="13px sans-serif";function G(t,e){return"CENTURY"===e.granularity&&new Date(t).getUTCFullYear()%1e3==0||("YEAR_5"===e.granularity&&new Date(t).getUTCFullYear()%50==0||"YEAR"===e.granularity&&new Date(t).getUTCFullYear()%5==0)}function Q(t,e,i,s,n){const o=e.positionAtTimestamp(i);t.moveTo(o,s),t.lineTo(o,n),e.config.rulerLabels&&t.fillText(x(i,e.granularity),o+3,n-3)}function tt(t,e){if(!e.config.rulers)return;let i=e.nextDate(e.from);const s=e.config.topOffsetRatio*X.viewportHeight,n=e.config.heightRatio*X.viewportHeight,o=[],r=[];for(;i<e.to;)G(i,e)?r.push(i):o.push(i),i=e.nextDate(i);t.beginPath(),t.font=K,t.fillStyle="rgb(205, 205, 205)";for(const i of o)Q(t,e,i,s,s+n);t.strokeStyle="rgb(235, 235, 235)",t.stroke(),t.beginPath(),t.font=q,t.fillStyle="rgb(120, 120, 120)";for(const i of r)Q(t,e,i,s,s+n);t.strokeStyle="rgb(150, 150, 150)",t.stroke()}class et{constructor(){this.indicatorsDrawn=!1,this.update=(()=>{X.bands.forEach(t=>{t instanceof k?this.drawEventsBand(t):this.drawMinimapBand(t)}),this.drawIndicators()}),O.registerView(this)}render(){return this.canvas=N("canvas","main",["position: absolute"]),this.canvas.width=X.viewportWidth,this.canvas.height=X.viewportHeight,this.ctx=this.canvas.getContext("2d"),this.indicatorsCanvas=N("canvas","indicators",["position: absolute"],["z-index: 1"]),this.indicatorsCanvas.width=X.viewportWidth,this.indicatorsCanvas.height=X.viewportHeight,this.indicatorsCtx=this.indicatorsCanvas.getContext("2d"),this.update(),[this.canvas,this.indicatorsCanvas]}resize(){this.indicatorsCanvas.width=X.viewportWidth,this.indicatorsCanvas.height=X.viewportHeight,this.canvas.width=X.viewportWidth,this.canvas.height=X.viewportHeight,this.indicatorsDrawn=!1}clear(t){this.ctx.clearRect(0,t.top,this.canvas.width,t.visibleHeight)}drawEventsBand(t){this.clear(t),tt(this.ctx,t),this.ctx.beginPath();for(const e of t.visibleEvents)e.time?this.ctx.rect(e.left,e.top,e.width,s):(this.ctx.moveTo(e.left,e.top+s/2),this.ctx.arc(e.left,e.top+s/2,s/3,0,2*Math.PI));this.ctx.fillStyle="rgb(216, 178, 178)",this.ctx.fill(),this.drawEventsText(t)}drawEventsText(t){this.ctx.font="11px sans-serif",this.ctx.fillStyle="rgb(126, 0, 0)";for(const e of t.visibleEvents){let t=0===e.time?e.padding:e.width,i=e.left;if(e.left<0&&0!==e.time&&(t=e.width+e.left,i=0),e.label.length*l<=t){const t=e.time?3:8;this.ctx.fillText(e.label,i+t,e.top+s-3)}}}drawMinimapBand(t){if(t.isDrawn&&t.prevOffsetX===t.offsetX&&t.prevZoomLevel===t.zoomLevel)return;this.clear(t),tt(this.ctx,t);const e=t.draw();this.ctx.drawImage(e,0,t.top,X.viewportWidth,t.availableHeight),t.isDrawn=!0}drawIndicators(){if(!this.indicatorsDrawn||!X.eventsBands.every(t=>t.prevZoomLevel===t.zoomLevel)){this.indicatorsCtx.clearRect(0,0,X.viewportWidth,X.viewportHeight),this.indicatorsCtx.beginPath();for(const t of X.minimapBands){const e=X.eventsBands[t.config.indicatorFor],i=Math.round(t.config.topOffsetRatio*X.viewportHeight),s=t.positionAtTimestamp(e.from);this.indicatorsCtx.rect(0,i,s,t.visibleHeight);const n=t.positionAtTimestamp(e.to);this.indicatorsCtx.rect(n,i,X.viewportWidth,t.visibleHeight),this.indicatorsCtx.rect(s,i+t.visibleHeight-o,n-s,o)}this.indicatorsCtx.fillStyle="rgba(0, 0, 0, .04)",this.indicatorsCtx.fill(),this.indicatorsCtx.closePath(),this.indicatorsDrawn=!0}}}class it{constructor(t){this.band=t}render(){const t=N("div","events-label-wrapper",["border-top: 1px solid #CCC","pointer-events: none","position: absolute","width: 100%","z-index: 3"],[`top: ${100*this.band.config.topOffsetRatio}%`]),e=N("div","events-label",["background: white","border-bottom-right-radius: 4px","box-shadow: 1px 2px 4px #AAA","color: #444","display: inline-block","font-family: sans-serif","font-size: .8em","padding: 4px 8px"]);return e.innerText=this.band.config.label,t.appendChild(e),t}resize(){}}class st{constructor(){this.date_granularity="DAY"}}i.d(e,"default",function(){return nt}),i.d(e,"TimelineConfig",function(){return R}),i.d(e,"EventsBand",function(){return k}),i.d(e,"MinimapBand",function(){return P}),i.d(e,"OrderedEvents",function(){return A}),i.d(e,"calcPixelsPerMillisecond",function(){return L}),i.d(e,"formatDate",function(){return C}),i.d(e,"orderEvents",function(){return $}),i.d(e,"RawEv3nt",function(){return st});class nt extends Z{constructor(t,e,i){super(e),this.config=t,this.onSelect=i,this.appendToWrapper=(t=>{let e=t.render();Array.isArray(e)||(e=[e]),e.forEach(t=>this.wrapper.appendChild(t))}),X.init(t),t.rootElement.appendChild(this.render());const s=M(this.resize,600);window.addEventListener("resize",s)}render(){this.wrapper=N("div","wrapper",["box-sizing: border-box","height: 100%","overflow: hidden","position: relative","user-select: none","width: 100%"]),this.views=X.bands.map(t=>t instanceof k?new J(t,this.onSelect):new V(t)),this.views.push(new et),this.views.forEach(this.appendToWrapper),this.renderLabels();const t=N("div","red-line",["background-color: rgb(126, 0, 0)","bottom: 0","left: calc(50% - 1px)","position: absolute","top: 0","width: 2px","z-index: 4"]);return this.wrapper.appendChild(t),this.wrapper}renderLabels(){X.bands.filter(t=>t instanceof k&&null!=t.config.label).map(t=>new it(t)).forEach(this.appendToWrapper)}}}])});